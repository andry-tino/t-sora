---
layout: post
title:  "Tutorial"
date:   2016-10-16 19:13:00 +0000
categories: post
description: Main tutorial for building a cross platform app
---
# Building a 3D Earth and Moon animation
In this tutorial you will learn how to use [HTML5](https://en.wikipedia.org/wiki/HTML5), [JavaScript](https://en.wikipedia.org/wiki/JavaScript), the [WebGL API](https://en.wikipedia.org/wiki/WebGL) and the [THREE library](https://threejs.org/) to create a 3D animation in your browser.

## Requirements
For this tutorial you are going to need:

1. An Internet browser. [Chrome](https://www.google.com/chrome/browser/desktop/index.html) is recommended because it has an easy way to disable [CORS](https://en.wikipedia.org/wiki/Cross-origin_resource_sharing) and a tutorial is provided here for that.
2. A text editor. [Visual Studio Code](https://code.visualstudio.com) is recommended because it has very good code highlight features and can be installed on all systems.

**Important** The browser you use must be updated to the latest version. We are going to use some very new functionalities introduced lately, so we need the latest version.

## A few things first...
Creating a 3D animation using Javascript and the WebGL API requires some code. In particular there is a lot of code for setting the basic stuff needed for whatever 3D project, namely a scene, a camera and some lights. Setting all these initial things together takes a lot of time and the WebGL API are very low level (every single point in a mesh is to be defined and a lot of matrix calculus is involved).

**THREE.js to the rescue** For this reason, we use a high level library called [THREE.js](https://threejs.org/) which hides all the mathematics behind objects and animations and lets us focus on the cool things. Thanks to this library, we are going to write much shorter code, making it easy to create objects and animate them.

**Preset pieces** Another detail to be aware of is that we are going to use a few snippets of code already prepared for you for some functionalities we are going to need. We could go though this code and build it together, but that would require some more time spent on a few minor things we don't want to focus on in the context of this tutorial. So we are just going to import and use it and that's all!

This tutorial also comes with some images we are going to use as well. They are going to be required once we start defining the material of the objects we'll create later.

## Defining the project structure
We start by creating the project structure with the folders and files we are going to need.

1. Go to this tutorial's source [Releases Git page](https://github.com/andry-tino/t-sora/releases).
2. Locate the latest Tutorial Kit and click on it.
3. In `Downloads`, locate the kit package (the other links contain the source code, don't choose them).
4. In your system, locate a place where you want to create the project. Usually your user's home folder in Linux and iOS, or the `Documents` folder in Windows are good choices.
2. Extract the package content there.

You should end up having the following folder structure:

```
+sora
|--+common
   |--shading.js
   |--utils.js
|--+deps
   |--three.js
|--+images
```

### Preset files
This is our start point. Inside the `sora` folder, there is all we need to start building our project.

| Path | Type | Description |
|------|:----:|-------------|
| `sora/common` | Folder | Contains all the common resources we will need |
| `sora/deps`   | Folder | Contains external libraries |
| `sora/images` | Folder | Contains the images and textures we need for materials |
| `common/shading.js` | JavaScript source | Has functions we will use for special 3D effects |
| `common/utils.js` | JavaScript source | Has some JavaScript utility functions for creating some complicated objects |
| `deps/three.js` | JavaScript source | The [THREE library](https://threejs.org/) |

### Completing the structure
The tutorial kit we just unpacked contains the initial set of folders and files we need. Now we need to start adding our stuff as, in this condition, we just have a few building blocks which do nothing.

#### Defining the homepage
We need to create the homepage of our project which will display the animation.

1. In your system, naivgate to directory `sora`.
2. Inside it, create a new directory called `earth`.
3. Inside `earth`, create 3 files called: `index.html`, `index.js` and `index.css`. Leave the files empty.

The folder structure should look like the following:

```
+sora
|--+earth
   |--index.html
   |--index.js
   |--index.css
```

We have basically created the initial structure for the homepage:

| File | Type | Description |
|------|:----:|-------------|
| `index.html` | HTML file | The homepage hosting the 3D animation |
| `index.js`   | JavaScript source file | The JavaScript source which will contain the code for creating the animation |
| `index.css` | CSS style source file | The style file for setting a few properties of the homepage |

#### Adding content
Let's now open `index.html`, and let's write the most basic HTML structure that every page needs to be correctly displayed in a browser:

{% highlight html linenos %}
<html>
  <head>
    <title>My first Three.js app</title>
  </head>
  <body>
	
  </body>
</html>
{% endhighlight %}

If you open this page in your browser, you will see just a blank page. We need to add some more stuff into it. So, inside the `<head>` tag, just under the `<title>`, add this line:

{% highlight html linenos %}
<meta http-equiv="Access-Control-Allow-Origin" content="*">
{% endhighlight %}

This line is not simple to explain. For now, let's say that we need it in order to see the 3D animation once we create it. The browser will not authorize the 3D rendering without this line because of some secutity-related issues. This line will allow us to run the animation and see it on the browser.

We now need to add a reference to `index.css`, our stylesheet. So after the line we just typed, let's add these lines:

{% highlight html linenos %}
<!-- The basic page style -->
<link rel="stylesheet" type="text/css" href="style.css">
{% endhighlight %}

This will allow us to import the content of `index.css` into our page.

Next step is to import some JavaScript files, we need to import `index.js`, `shading.js` and `utils.js` (the last 2 reside in the `common` folder). So let's add these lines after the lines we entered before:

{% highlight html linenos %}
<!-- Stuff we need: external libraries and help scripts -->
<script type="text/javascript" src="../deps/three.js"></script>
<script type="text/javascript" src="../common/utils.js"></script>
<script type="text/javascript" src="../common/shading.js"></script>
{% endhighlight %}

We have imported the THREE library and some other files we will need later. However, we are missing one file: `index.js` which we need to import because, later, we will add the JavaScript code for the animation there. So let's add this final line of code after those we have just written a while ago:

{% highlight html linenos %}
<!-- Our code -->
<script type="text/javascript" src="index.js"></script>
{% endhighlight %}

We are done for now with `index.html` which should look like this:

{% highlight html linenos %}
<html>
  <head>
    <title>My first Three.js app</title>

    <!-- The basic page style -->
    <link rel="stylesheet" type="text/css" href="style.css">

    <!-- Stuff we need: external libraries and help scripts -->
    <script type="text/javascript" src="../deps/three.js"></script>
    <script type="text/javascript" src="../common/utils.js"></script>
    <script type="text/javascript" src="../common/shading.js"></script>

    <!-- Our code -->
    <script type="text/javascript" src="index.js"></script>
  </head>
  <body>

  </body>
</html>
{% endhighlight %}

### A few styling settings
Before deep diving into the JavaScript code, let's first make sure that the 3D scenen we are going to build takes all the browser window's size. To do so, let's open `index.css` (which we just imported into `index.html`) and type in the following code:

{% highlight css linenos %}
body {
  margin: 0;
}

canvas { 
  width: 100%; 
  height: 100%;
}
{% endhighlight %}

This instructs the browser not to create the border margin. Also it instructs it to make the `<canvas>` element fill the entire space once we place it there. The `<canvas>` is something we are going to create later, basically it will contain the 3D world we are going to create.

## Building the 3D scene
Now that `index.html` is importing everything we need and we also have the correct style in place, we can start writing down the logic for building the animation. So, we start by opening `index.js` and typing in the following lines:

{% highlight javascript linenos %}
window.addEventListener("load", function() {
  // Our code goes here
});
{% endhighlight %}

Function `addEventListener` will wait that the page loads before running the code inside the anonymous function passed in as second argument. As the comment is showing, we will write our code inside that anonymous function, so that we are certain that the page has finished loading all the imports and the style, before we create our 3D scene.
